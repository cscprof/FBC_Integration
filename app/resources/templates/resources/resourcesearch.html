{% extends 'base.html' %}

{% block title %}Flourish Beaver County - Resource Directory{% endblock %}

{% block content %}

<section class="section">
    <div class="container">
        <h1 class="title has-text-centered">Resource Directory</h1>
        <p class="has-text-centered is-size-5 mb-5" style="color: #666; margin-top: 10px;">
            Everything you need to succeed - from college prep to mental health support
        </p>

        <div class="uploadbutton">
            <button onclick="document.getElementById('uploadModal').style.display='block'" class="uploadresourcebtn">
                Upload Resource
            </button>
        </div>

        <div class="resources">
            <div class="searchfilter">
                <div class="searchcontainer">
                    <form class="searchform">
                        <input type="text" placeholder="Search resources..." class="searchinput" name="search">
                        
                    </form>
                </div>

                <div class="categorydropdown">
                    <select class="categoryselect">
                        <option value="all">All Categories</option>
                        <option value="college">College</option>
                        <option value="mental">Mental Health</option>
                        <option value="jobs">Jobs</option>
                        <option value="tutoring">Tutoring</option>
                        <option value="activities">Activities</option>
                        <option value="career">Career</option>
                    </select>
                </div>
            </div>

            <div class="examplegrid" id="resourcesgrid">
                {% for resource in resources %}
                <div class="exampleboxes" data-category="{{ resource.resource_category_name }}">
                    <h3>{{ resource.description }}</h3>
                    {%  if resource.contact_name %}
                    <br>
                    <h4>{{ resource.contact_name }}</h4>
                    {% endif %}
                    {%  if resource.contact_email %}
                    <h6>{{ resource.contact_email }}</h6>
                    {% endif %}
                    {%  if resource.contact_phone %}
                    <h6>{{ resource.contact_phone }}</h6>
                    {% endif %}
                    <a href="{{ resource.url }}" class="resourcelink" target="_blank">{{ resource.url }}</a>
                </div>
                {% endfor %}
            </div>
        </div>

        
    </div>
</section>

<div id="uploadModal">
    <div class="modalcontent">
        <div class="modalheader">
            <h2 class="modaltitle">Upload Resource</h2>
        </div>

        <form action="{{ url_for('resources.upload_resource') }}" method="POST" class="modalform">
            <input type="text" name="title" placeholder="Title *" required>
            <input type="text" name="url" placeholder="URL *" required>
            <select name="resource_category_id" required>
                <option value="">Category *</option>
                {% if categories %}
                    {% for cat in categories %}
                        <option value="{{ cat.resource_category_id }}">{{ cat.resource_category_name|title }}</option>
                    {% endfor %}
                {% else %}
                    <option value="1">College</option>
                    <option value="2">Mental</option>
                    <option value="3">Jobs</option>
                    <option value="4">Tutoring</option>
                    <option value="5">Activities</option>
                    <option value="6">Career</option>
                {% endif %}
            </select>

            <div class="modalformactions">
                <button type="button" onclick="document.getElementById('uploadModal').style.display='none'" class="modalbtncancel">Cancel</button>
                <button type="submit" class="modalbtnsubmit">Submit</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.querySelector(".searchinput");
    const categorySelect = document.querySelector(".categoryselect");
    const resourceBoxes = document.querySelectorAll(".exampleboxes");
    const urlParams = new URLSearchParams(window.location.search);
    const categoryParam = urlParams.get('category');
    if (categoryParam) {
        categorySelect.value = categoryParam;
    }

    function filterResources() {
        const searchValue = searchInput.value.toLowerCase();
        const selectedCategory = categorySelect.value;

        resourceBoxes.forEach(box => {
            const boxCategory = box.getAttribute("data-category");
            const textContent = box.innerText.toLowerCase();

            const matchesSearch = textContent.includes(searchValue);
            const matchesCategory =
                selectedCategory === "all" || boxCategory === selectedCategory;

            if (matchesSearch && matchesCategory) {
                box.style.display = "block";
            } else {
                box.style.display = "none";
            }
        });
    }

    searchInput.addEventListener("keyup", filterResources);
    categorySelect.addEventListener("change", filterResources);

    if (categoryParam) {
        filterResources();
    }
});
</script>

{% endblock %}
